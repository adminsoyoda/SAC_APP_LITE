<script type="text/javascript">
        
    (function() {
        $("#containerAct").hide();
        setTimeout(function() {
            $("#containerAct").show();
        }, 100);

        $("#opt_ListaResponsable").html("");
        BDConsultaOBJ("SELECT * FROM APP_RESPONSABLE ORDER BY DEPARTAMENTO ASC", function (obj) {
            for (var i = 0; i < obj.rows.length; i++) {
                var row = obj.rows.item(i);
                $("#opt_ListaResponsable").append("<option value='"+row.CODIGO+"'>"+row.DEPARTAMENTO+"</option>");
            }  
        });
    })(); 

    function fn_ListaItemsSearch(evento) 
    {
        var key = validaEvento(evento);

        $("#tagItemsSearch_Lineas").html("");

        if (key == 13) {
            //hideKeyboard(evento);        
            $("#loader_sys_btn_show").click();
            var ITEMCODE=$("#tagSearchITEMCODE").val().replace(/ /g, '%');
            var ITEMNAME=$("#tagSearchITEMCODE").val().replace(/ /g, '%');
            var ITMSGRPNAM=$("#tagSearchITEMCODE").val().replace(/ /g, '%');

            BDConsultaOBJ("SELECT ITEMCODE,ITEMNAME,ITMSGRPNAM,ONHAND,PRICE,SALUNITMSR,SALPACKMSR FROM APP_ITEM WHERE EMPRESA='" + masterEmpresa.trim() + "'  AND (ITEMCODE LIKE '%" + ITEMCODE + "%' OR ITEMNAME LIKE '%" + ITEMNAME + "%' OR ITMSGRPNAM LIKE '%" + ITMSGRPNAM + "%' )  ORDER BY ITEMCODE ASC LIMIT 50;", function (obj) {
                  
                  var data="";

                  for (var i = 0; i < obj.rows.length; i++) {
                      var row = obj.rows.item(i);

                      data = data +"<li><a href='#' onclick='fn_SeleccionItemsAct(\"" + row.ITEMCODE + "\",\"" + row.ITEMNAME + "\")' style='overflow-x:scroll' class='ui-btn'><table class='table table-hover table-striped' style='width: 100%'><tbody><tr style='color: #f39c12 !important;'><td style='width: 30%;padding: 5px;'><strong class='text-yellow'>Codigo</strong></td><td style='width: 55%;padding: 5px;'><strong class='text-yellow'>Descripción</strong></td><td style='width: 15%;padding: 5px;'><strong class='text-yellow'>Linea</strong></td></tr>                                                                                            <tr><td id='tdCode"+i+"' style='width: 30%;padding: 5px;'>" + row.ITEMCODE + "</td><td style='width: 55%;padding: 5px;'>" + row.ITEMNAME + "</td><td style='width: 15%;padding: 5px;'>" + row.ITMSGRPNAM + "</td></tr></tbody></table></a></li>";
                  };    
                  $("#tagItemsSearch_Lineas").html(data);
                  $('#tagItemsSearch_Lineas').listview('refresh');
                  $("#tagItemsSearch_Lineas").trigger("create");
                  
                  $("#loader_sys_btn_hide").click();
            });
        }
    }

    function fn_GoToListItem()
    {
        $("#tagItemsSearch_Lineas").html("");
        $("#containerAct").hide();
        $("#containerItem").show();
    }

    function fn_ReturnAct() 
    {
        $("#containerItem").hide();
        $("#containerAct").show();
    }

    function fn_SeleccionItemsAct(ITEMCODE,ITEMNAME) 
    {
        $("#loader_sys_btn_show").click();
        $("#tagITEMNAMEAct").val(ITEMNAME);
        $("#tagITEMCODEAct").val(ITEMCODE);
        $("#loader_sys_btn_hide").click();
        fn_ReturnAct();
    }

    function fn_SaveActividad()
    {
        if($("#opt_ListaResponsable").val()=="select"){
            alert("Debe dirigir la actividad!");
            return;
        }

        if($("#Op_Nota").val()==""){
            alert("Debe ingresar el detalle de la actividad!");
            return;
        }

        if($("#tagITEMCODEAct").val()==""){
            var res = confirm("No a selecionado Item, ¿desea Continuar?");
            if (res==false){return;}
        }

        $("#loader_sys_btn_show").click();
        BDConsulta("SELECT MAX(IDACTIVIDAD) IDACTIVIDAD FROM APP_ACTIVIDAD", function (obj) {
            var strFecha= (FECHAAPERTURA.getMonth()+1)+"/"+FECHAAPERTURA.getDate()+"/"+FECHAAPERTURA.getFullYear()+" "+FECHAAPERTURA.getHours()+":"+FECHAAPERTURA.getMinutes();
            BDActualizacion("INSERT INTO APP_ACTIVIDAD (IDACTIVIDAD,IDGESTION,IDRESPONSABLE,RESPONSABLE,CARDCODE,ITEMCODE,ITEMNAME,IDUSUARIOVENDEDOR,EMPRESA,NOTA)  VALUES("+(obj.IDACTIVIDAD + 1)+","+IDGESTION+",'"+$("#opt_ListaResponsable").val()+"','"+$("#opt_ListaResponsable option:selected").text()+"','"+CARDCODE+"','"+ $("#tagITEMCODEAct").val() +"','"+$("#tagITEMNAMEAct").val()+"','"+masterUsuario+"','"+masterEmpresa.trim()+"','"+$('#Op_Nota').val()+"');");
            $("#loader_sys_btn_hide").click();
            alert("Los datos se guardaron correctamente!")
            fn_ReturnMain()
        });

    }
</script>
<div role="container" id="containerAct">
    <div data-role="header" >
        <a href="#" class="ui-btn ui-shadow ui-corner-all ui-icon-tag ui-btn-icon-notext"></a>
        <h1 style="font-size: 16px;">Actividad</h1>
    </div>
    <div>
        <label style="padding-top: 30px;"><strong>Dirigido a:</strong></label>
        <select id="opt_ListaResponsable"></select>

        <label style="padding-top: 30px;"><strong>Item(Opcional):</strong></label>
        <input type="text" id="tagITEMNAMEAct" readonly style="height: 55px;" >
        <input type="hidden" id="tagITEMCODEAct">
        <div data-role="controlgroup" data-type="horizontal">
            <a href="#" class="ui-btn btn-lg-right ui-btn-icon-left ui-icon-plus ui-btn-inline" style="margin: 0" onclick="fn_GoToListItem();">Seleccionar Item</a>
            <a href="#" class="ui-btn btn-lg-left ui-btn-icon-right ui-icon-delete cus-dan-ele ui-btn-inline" style="margin: 0" onclick="$('#tagITEMNAMEAct').val('');$('#tagITEMCODEAct').val('');">Quitar</a>
        </div>

        <textarea placeholder="Detalle de la Actividad" style="margin-top: 30px;" id="Op_Nota"></textarea>
        <div style="text-align: right;">
            <div class="ui-grid-a">
                <div class="ui-block-a">
                    <a href="#" class="ui-btn btn-lg-right ui-btn-icon-left ui-icon-delete" style="" onclick="fn_ReturnMain()">Cancelar</a>
                </div>
                <div class="ui-block-b">
                    <a href="#" class="ui-btn btn-lg-right cus-suc-ele ui-btn-icon-left ui-icon-check" style="" onclick="fn_SaveActividad();">Ingresar Actividad</a>    
                </div>
            </div>
        </div>
    </div>
</div>

<div role="container" id="containerItem" style="padding: 15px;background: white;height: 100%x;display: none">
    <a href="#" class="ui-btn btn-lg-left ui-icon-delete ui-btn-icon-right ui-corner-all" style="float: right; top: -10px;" onclick="fn_ReturnAct()">Cerrar</a>  
    <div style="padding: 70px 20px 0px 20px;">
      <input type="text" id="tagSearchITEMCODE" style="height: 55px;" placeholder="Atributo del item a buscar" onkeypress="fn_ListaItemsSearch(event)">
    </div>
    <div style="overflow-y: scroll;height: 600px;padding: 0px 20px 0px 20px;" >
        <ul data-role="listview" data-inset="true" id="tagItemsSearch_Lineas" style="font-size: 15px;">
        </ul>
    </div>
</div>



